Mokapot
=======

Mokapot is an application and library for allowing you to run Java
programs distributed across multiple Java virtual machines (which
would typically run on different physical machines, allowing the
workload of running the program to be shared between those machines).

Typically, a program you write (that you want to distribute) would
depend on Mokapot as a dependency; Mokapot itself would be run (as an
application) on all but one JVM you wanted to use ("servers", because
they do nothing but wait for commands from the client), and your
program itself would run on the remaining JVM (the "client").

You only need to take four steps in your own client program to take
advantage of Mokapot.  First, create a `DistributedCommunicator`:

    DistributedCommunicator communicator =
        new DistributedCommunicator("key.p12", password)
            .startCommunication();

Second, look up the `CommunicationAddress` for the server you want to
connect to.  You can, e.g., serialise these to disk, but the simplest
method is to just contact the server via its IP address and port to
ask it what its address is:

    CommunicationAddress serverAddress =
        communicator.lookupAddress(
            InetAddress.getLoopbackAddress(), 15239);

Third, just run at least one method remotely on the server.  Most
commonly, this would be a constructor, allowing you to create a local
reference to an object on the server:

    List<String> remoteList = communicator.runRemotely(
        () -> new ArrayList<>(), serverAddress);

Finally, remember to shut down the communicator when you're done
(i.e. there are no cross-system references left to or from your own
system):

    communicator.stopCommunication();

Everything else is handled transparently by Mokapot; for example, a
method call to an object can just be written as a normal Java method
call, and will work like a normal Java method call regardless of what
system the object's data is stored on.  This is very much just Java,
just that the references can cross the boundary between one Java
virtual machine and another, even running on different systems.

Creating your own server is arguably even easier.  You'll need to
specify a hostname and port in `DistributedCommunicator`'s
constructor, but there's no need to remotely run any methods at all;
just sit back and wait for the clients to connect.  Note that the
clients and servers must be running the same codebase (so you'd want
one `main` method for the client, and another for the server).  You
could just use `DistributedServer` directly, if you prefer.

Note that Mokapot has several limitations that may prevent it working
on arbitrary programs (see the "limitations" section of
[Guide.md](Guide.md)); in most cases, it will be possible to rewrite
the program to comply with the limitations. The majority of things
that Mokapot can't do are things that are bad Java style anyway (such
as accessing a `public` non-`static` property), although a few of the
limitations may arise even with more reasonable code. A companion
program, Millr, will eventually become available to perform this
rewrite automatically.

Security
--------

Because the whole purpose of this library is to allow systems to run
arbitrary code on each other, there are understandably security
precuations that need to be taken.  The main concept here is that of a
white-list of systems that are allowed to contact each other, with
each system on the list trusting each other system on the list
absolutely, but refusing connection from any system that is not on the
list.

Each system's "identity" is stored in a `.p12` file; each system has
its own file.  (Although these files are password-protected, they
should nonetheless be kept secret and not exist on any system other
than the system they belong to, especially as the password will need
to be stored somewhere if you want to be able to start the clients and
servers up without user intervention.)  These files are generated by a
"white-list controller"; files generated by the same controller will
be able to recognise each other, knowing that they're all part of the
same white-list, but without access to the controller, generating a
suitable `.p12` file to allow a system connection is believed to be
impossible.  The controller doesn't need to be online or even to exist
once the files are generated; you could delete it immediately after
generating all the `.p12` files you'll need, or you could keep it
around in case you need to add new systems to the computation later.

More detailed information on how to secure your Mokapot system is
contained in [Guide.md](Guide.md).

Building/depending on Mokapot
-----------------------------

See [Install.md](Install.md) for information on how to build Mokapot,
or to add it as a dependency of your build system.

Using Mokapot
-------------

See [Guide.md](Guide.md) for an introduction on how to use Mokapot in
your programs.
